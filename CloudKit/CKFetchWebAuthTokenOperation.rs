//! This file has been automatically generated by `objc2`'s `header-translator`.
//! DO NOT EDIT
use core::ffi::*;
use core::ptr::NonNull;
use objc2::__framework_prelude::*;
use objc2_foundation::*;

use crate::*;

extern_class!(
    /// An operation that creates an authentication token for use with CloudKit web services.
    ///
    /// ## Overview
    ///
    /// CloudKit web services provides an HTTP interface to fetch, create, update, and delete records, zones, and subscriptions. Each request you send requires an API token, which you configure in [CloudKit Dashboard](https://icloud.developer.apple.com). You must create an API token for each container in each environment.
    ///
    /// If you want to send a request to an endpoint that requires an authenticated user, use this operation to fetch an authentication token. Append the authentication token, along with the API token, to the endpoint’s URL. That request then acts on behalf of the current user. Authentication tokens are short-lived and expire after a single use.
    ///
    /// For an example of using a web authentication token with a CloudKit web service, see [Changing Access Controls on User Data](https://developer.apple.com/documentation/cloudkit/changing-access-controls-on-user-data).
    ///
    /// This operation executes the handlers you provide on an internal queue it manages. Your handlers must be capable of executing on a background queue. Tasks that need access to the main queue must redirect as appropriate.
    ///
    /// The operation calls [`fetchWebAuthTokenCompletionBlock`](https://developer.apple.com/documentation/cloudkit/ckfetchwebauthtokenoperation/fetchwebauthtokencompletionblock) after it executes to provide the fetched token. Use the completion handler to perform housekeeping tasks for the operation. It should also manage any failures, whether due to an error or an explicit cancellation.
    ///
    /// <div class="warning">
    ///
    /// ### Note
    ///  Because this class inherits from [`NSOperation`](https://developer.apple.com/documentation/foundation/operation), you can also set the [`completionBlock`](https://developer.apple.com/documentation/foundation/operation/completionblock) property. The operation calls both completion handlers if they’re both set.
    ///
    ///
    ///
    /// </div>
    /// CloudKit operations have a default QoS of [`NSQualityOfServiceDefault`](https://developer.apple.com/documentation/foundation/qualityofservice/default). Operations with this service level are discretionary. The system schedules their execution at an optimal time according to battery level and network conditions, among other factors. Use the [`qualityOfService`](https://developer.apple.com/documentation/foundation/operation/qualityofservice) property to set a more appropriate QoS for the operation.
    ///
    /// The following example shows how to create the operation, configure its callbacks, and execute it in the user’s private database:
    ///
    /// ```swift
    /// func fetchWebAuthToken(for apiToken: String,
    ///     completion: @escaping (Result<String, Error>) -> Void) {
    ///     
    ///     // Create the operation using the API token
    ///     // that the caller provides to the method.
    ///     let operation = CKFetchWebAuthTokenOperation(apiToken: apiToken)
    ///     
    ///     // If the operation fails, return the error to the caller.
    ///     // Otherwise, return the fetched authentication token.
    ///     operation.fetchWebAuthTokenCompletionBlock = { webToken, error in
    ///         if let error = error {
    ///             completion(.failure(error))
    ///         } else {
    ///             completion(.success(webToken!))
    ///         }
    ///     }
    ///     
    ///     // Set an appropriate QoS and add the operation to the
    ///     // private database's queue to execute it.
    ///     operation.qualityOfService = .utility
    ///     CKContainer.default().privateCloudDatabase.add(operation)
    /// }
    /// ```
    ///
    ///
    /// This operation will fetch a web auth token given an API token obtained from the CloudKit Dashboard for your container
    #[unsafe(super(CKDatabaseOperation, CKOperation, NSOperation, NSObject))]
    #[derive(Debug, PartialEq, Eq, Hash)]
    #[cfg(all(feature = "CKDatabaseOperation", feature = "CKOperation"))]
    pub struct CKFetchWebAuthTokenOperation;
);

#[cfg(all(feature = "CKDatabaseOperation", feature = "CKOperation"))]
extern_conformance!(
    unsafe impl NSObjectProtocol for CKFetchWebAuthTokenOperation {}
);

#[cfg(all(feature = "CKDatabaseOperation", feature = "CKOperation"))]
impl CKFetchWebAuthTokenOperation {
    extern_methods!(
        #[unsafe(method(init))]
        #[unsafe(method_family = init)]
        pub unsafe fn init(this: Allocated<Self>) -> Retained<Self>;

        #[unsafe(method(initWithAPIToken:))]
        #[unsafe(method_family = init)]
        pub unsafe fn initWithAPIToken(
            this: Allocated<Self>,
            api_token: &NSString,
        ) -> Retained<Self>;

        /// APIToken is expected to be set before you begin this operation.
        ///
        /// This property is not atomic.
        ///
        /// # Safety
        ///
        /// This might not be thread-safe.
        #[unsafe(method(APIToken))]
        #[unsafe(method_family = none)]
        pub unsafe fn APIToken(&self) -> Option<Retained<NSString>>;

        /// Setter for [`APIToken`][Self::APIToken].
        ///
        /// This is [copied][objc2_foundation::NSCopying::copy] when set.
        ///
        /// # Safety
        ///
        /// This might not be thread-safe.
        #[unsafe(method(setAPIToken:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setAPIToken(&self, api_token: Option<&NSString>);

        #[cfg(feature = "block2")]
        /// This block is called when the operation completes.
        ///
        ///
        /// The
        ///
        /// ```text
        ///  -[NSOperation completionBlock]
        /// ```
        ///
        /// will also be called if both are set.
        /// Each
        /// `CKOperation`instance has a private serial queue. This queue is used for all callback block invocations.
        /// This block may share mutable state with other blocks assigned to this operation, but any such mutable state
        /// should not be concurrently used outside of blocks assigned to this operation.
        ///
        /// This property is not atomic.
        ///
        /// # Safety
        ///
        /// - The returned block's argument 1 must be a valid pointer or null.
        /// - The returned block's argument 2 must be a valid pointer or null.
        /// - This might not be thread-safe.
        #[unsafe(method(fetchWebAuthTokenCompletionBlock))]
        #[unsafe(method_family = none)]
        pub unsafe fn fetchWebAuthTokenCompletionBlock(
            &self,
        ) -> *mut block2::DynBlock<dyn Fn(*mut NSString, *mut NSError)>;

        #[cfg(feature = "block2")]
        /// Setter for [`fetchWebAuthTokenCompletionBlock`][Self::fetchWebAuthTokenCompletionBlock].
        ///
        /// This is [copied][objc2_foundation::NSCopying::copy] when set.
        ///
        /// # Safety
        ///
        /// This might not be thread-safe.
        #[unsafe(method(setFetchWebAuthTokenCompletionBlock:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setFetchWebAuthTokenCompletionBlock(
            &self,
            fetch_web_auth_token_completion_block: Option<
                &block2::DynBlock<dyn Fn(*mut NSString, *mut NSError)>,
            >,
        );
    );
}

/// Methods declared on superclass `NSObject`.
#[cfg(all(feature = "CKDatabaseOperation", feature = "CKOperation"))]
impl CKFetchWebAuthTokenOperation {
    extern_methods!(
        #[unsafe(method(new))]
        #[unsafe(method_family = new)]
        pub unsafe fn new() -> Retained<Self>;
    );
}
