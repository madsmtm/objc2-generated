//! This file has been automatically generated by `objc2`'s `header-translator`.
//! DO NOT EDIT
use core::ffi::*;
use core::ptr::NonNull;
use objc2::__framework_prelude::*;
use objc2_foundation::*;

use crate::*;

extern_class!(
    /// An operation that confirms a user’s participation in a share.
    ///
    /// ## Overview
    ///
    /// Use this operation to accept participation in one or more shares. You create the operation with an array of share metadatas, which CloudKit provides to your app when the user taps or clicks a share’s [`URL`](https://developer.apple.com/documentation/cloudkit/ckshare/url). The method CloudKit calls varies by platform and app configuration. For more information, see [`CKShareMetadata`](https://developer.apple.com/documentation/cloudkit/ckshare/metadata). You can also fetch a share’s metadata using [`CKFetchShareMetadataOperation`](https://developer.apple.com/documentation/cloudkit/ckfetchsharemetadataoperation).
    ///
    /// If there are several metadatas, group them by their [`containerIdentifier`](https://developer.apple.com/documentation/cloudkit/ckshare/metadata/containeridentifier) and create an operation for each container. Then add the operation to each container’s operation queue to run it. The operation executes its callbacks on a private serial queue.
    ///
    /// The operation calls [`perShareCompletionBlock`](https://developer.apple.com/documentation/cloudkit/ckacceptsharesoperation/persharecompletionblock) once for each metadata you provide. CloudKit returns the metadata and its related share, or an error if it can’t accept the share. CloudKit also batches per-metadata errors. If the operation completes with errors, it returns a [`partialFailure`](https://developer.apple.com/documentation/cloudkit/ckerror/partialfailure) error. The error stores individual errors in its [`userInfo`](https://developer.apple.com/documentation/foundation/nserror/userinfo) dictionary. Use the [`CKPartialErrorsByItemIDKey`](https://developer.apple.com/documentation/cloudkit/ckpartialerrorsbyitemidkey) key to extract them.
    ///
    /// After CloudKit applies all record changes, the operation calls [`acceptSharesCompletionBlock`](https://developer.apple.com/documentation/cloudkit/ckacceptsharesoperation/acceptsharescompletionblock). When the closure executes, the server may continue processing residual tasks of the operation, such as creating the record zone in the user’s private database.
    ///
    /// The following example demonstrates how to accept a share that CloudKit provides to your window scene delegate. It shows how to create the operation, configure it, and execute it in the correct container:
    ///
    /// ```swift
    /// func windowScene(_ windowScene: UIWindowScene,
    ///     userDidAcceptCloudKitShareWith cloudKitShareMetadata: CKShare.Metadata) {
    ///     
    ///     // Accept the share. If successful, schedule a fetch of the
    ///     // share's root record.
    ///     acceptShare(metadata: cloudKitShareMetadata) { [weak self] result in
    ///         switch result {
    ///         case .success(let recordID):
    ///             self?.fetchRootRecordAndNotifyObservers(recordID)
    ///         case .failure(let error):
    ///             // Handle the error...
    ///         }
    ///     }
    /// }
    ///     
    /// func acceptShare(metadata: CKShare.Metadata,
    ///     completion: @escaping (Result<CKRecord.ID, Error>) -> Void) {
    ///     
    ///     // Create a reference to the share's container so the operation
    ///     // executes in the correct context.
    ///     let container = CKContainer(identifier: metadata.containerIdentifier)
    ///     
    ///     // Create the operation using the metadata the caller provides.
    ///     let operation = CKAcceptSharesOperation(shareMetadatas: [metadata])
    ///         
    ///     var rootRecordID: CKRecord.ID!
    ///     // If CloudKit accepts the share, cache the root record's ID.
    ///     // The completion closure handles any errors.
    ///     operation.perShareCompletionBlock = { metadata, share, error in
    ///         if let _ = share, error == nil {
    ///             rootRecordID = hierarchicalRootRecordID
    ///         }
    ///     }
    ///
    ///     // If the operation fails, return the error to the caller.
    ///     // Otherwise, return the record ID of the share's root record.
    ///     operation.acceptSharesCompletionBlock = { error in
    ///         if let error = error {
    ///             completion(.failure(error))
    ///         } else {
    ///             completion(.success(rootRecordID))
    ///         }
    ///     }
    ///
    ///     // Set an appropriate QoS and add the operation to the
    ///     // container's queue to execute it.
    ///     operation.qualityOfService = .utility
    ///     container.add(operation)
    /// }
    /// ```
    ///
    ///
    #[unsafe(super(CKOperation, NSOperation, NSObject))]
    #[derive(Debug, PartialEq, Eq, Hash)]
    #[cfg(feature = "CKOperation")]
    pub struct CKAcceptSharesOperation;
);

#[cfg(feature = "CKOperation")]
extern_conformance!(
    unsafe impl NSObjectProtocol for CKAcceptSharesOperation {}
);

#[cfg(feature = "CKOperation")]
impl CKAcceptSharesOperation {
    extern_methods!(
        #[unsafe(method(init))]
        #[unsafe(method_family = init)]
        pub unsafe fn init(this: Allocated<Self>) -> Retained<Self>;

        #[cfg(feature = "CKShareMetadata")]
        #[unsafe(method(initWithShareMetadatas:))]
        #[unsafe(method_family = init)]
        pub unsafe fn initWithShareMetadatas(
            this: Allocated<Self>,
            share_metadatas: &NSArray<CKShareMetadata>,
        ) -> Retained<Self>;

        #[cfg(feature = "CKShareMetadata")]
        /// This property is not atomic.
        ///
        /// # Safety
        ///
        /// This might not be thread-safe.
        #[unsafe(method(shareMetadatas))]
        #[unsafe(method_family = none)]
        pub unsafe fn shareMetadatas(&self) -> Option<Retained<NSArray<CKShareMetadata>>>;

        #[cfg(feature = "CKShareMetadata")]
        /// Setter for [`shareMetadatas`][Self::shareMetadatas].
        ///
        /// This is [copied][objc2_foundation::NSCopying::copy] when set.
        ///
        /// # Safety
        ///
        /// This might not be thread-safe.
        #[unsafe(method(setShareMetadatas:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setShareMetadatas(&self, share_metadatas: Option<&NSArray<CKShareMetadata>>);

        #[cfg(all(
            feature = "CKRecord",
            feature = "CKShare",
            feature = "CKShareMetadata",
            feature = "block2"
        ))]
        /// Called once for each share metadata that the server processed
        ///
        ///
        /// If error is nil then the share was successfully accepted.
        /// Each
        /// `CKOperation`instance has a private serial queue. This queue is used for all callback block invocations.
        /// This block may share mutable state with other blocks assigned to this operation, but any such mutable state
        /// should not be concurrently used outside of blocks assigned to this operation.
        ///
        /// This property is not atomic.
        ///
        /// # Safety
        ///
        /// - The returned block's argument 1 must be a valid pointer.
        /// - The returned block's argument 2 must be a valid pointer or null.
        /// - The returned block's argument 3 must be a valid pointer or null.
        /// - This might not be thread-safe.
        #[unsafe(method(perShareCompletionBlock))]
        #[unsafe(method_family = none)]
        pub unsafe fn perShareCompletionBlock(
            &self,
        ) -> *mut block2::DynBlock<dyn Fn(NonNull<CKShareMetadata>, *mut CKShare, *mut NSError)>;

        #[cfg(all(
            feature = "CKRecord",
            feature = "CKShare",
            feature = "CKShareMetadata",
            feature = "block2"
        ))]
        /// Setter for [`perShareCompletionBlock`][Self::perShareCompletionBlock].
        ///
        /// This is [copied][objc2_foundation::NSCopying::copy] when set.
        ///
        /// # Safety
        ///
        /// This might not be thread-safe.
        #[unsafe(method(setPerShareCompletionBlock:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setPerShareCompletionBlock(
            &self,
            per_share_completion_block: Option<
                &block2::DynBlock<dyn Fn(NonNull<CKShareMetadata>, *mut CKShare, *mut NSError)>,
            >,
        );

        #[cfg(feature = "block2")]
        /// This block is called when the operation completes.
        ///
        ///
        /// The
        ///
        /// ```text
        ///  -[NSOperation completionBlock]
        /// ```
        ///
        /// will also be called if both are set.
        /// If the error is
        /// `CKErrorPartialFailure,`the error's userInfo dictionary contains a dictionary of shareURLs to errors keyed off of
        /// `CKPartialErrorsByItemIDKey.`These errors are repeats of those sent back in previous
        /// `perShareCompletionBlock`invocations
        /// Each
        /// `CKOperation`instance has a private serial queue. This queue is used for all callback block invocations.
        /// This block may share mutable state with other blocks assigned to this operation, but any such mutable state
        /// should not be concurrently used outside of blocks assigned to this operation.
        ///
        /// This property is not atomic.
        ///
        /// # Safety
        ///
        /// - The returned block's argument must be a valid pointer or null.
        /// - This might not be thread-safe.
        #[unsafe(method(acceptSharesCompletionBlock))]
        #[unsafe(method_family = none)]
        pub unsafe fn acceptSharesCompletionBlock(
            &self,
        ) -> *mut block2::DynBlock<dyn Fn(*mut NSError)>;

        #[cfg(feature = "block2")]
        /// Setter for [`acceptSharesCompletionBlock`][Self::acceptSharesCompletionBlock].
        ///
        /// This is [copied][objc2_foundation::NSCopying::copy] when set.
        ///
        /// # Safety
        ///
        /// This might not be thread-safe.
        #[unsafe(method(setAcceptSharesCompletionBlock:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setAcceptSharesCompletionBlock(
            &self,
            accept_shares_completion_block: Option<&block2::DynBlock<dyn Fn(*mut NSError)>>,
        );
    );
}

/// Methods declared on superclass `NSObject`.
#[cfg(feature = "CKOperation")]
impl CKAcceptSharesOperation {
    extern_methods!(
        #[unsafe(method(new))]
        #[unsafe(method_family = new)]
        pub unsafe fn new() -> Retained<Self>;
    );
}
