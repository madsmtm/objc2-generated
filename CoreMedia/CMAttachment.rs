//! This file has been automatically generated by `objc2`'s `header-translator`.
//! DO NOT EDIT
use core::ffi::*;
use core::ptr::NonNull;
use objc2_core_foundation::*;

use crate::*;

/// An object that can carry attachments.
///
/// ## Discussion
///
/// A `CMAttachmentBearer` is a Core Foundation-based object that supports the suite of key/value/mode attachment APIs. Since “plain” C has no type subclassing, the framework uses `CFType` as the basis for the `CMAttachmentBearer` type. Not all `CFTypes` support `CMAttachmentBearer` methods, so if you call a `CMAttachmentBearer` method on a Core Foundation object that doesn’t support it, it fails.
///
///
#[doc(alias = "CMAttachmentBearerRef")]
pub type CMAttachmentBearer = CFType;

/// The mode to use when propagating attachments.
///
/// ## Discussion
///
/// Set these attributes when adding attachments to a [`CMAttachmentBearerRef`](https://developer.apple.com/documentation/coremedia/cmattachmentbearer) object.
///
///
pub type CMAttachmentMode = u32;

/// A mode that doesn’t propagate attachments to another object.
pub const kCMAttachmentMode_ShouldNotPropagate: CMAttachmentMode = 0;
/// A mode that propagates attachments to another object.
pub const kCMAttachmentMode_ShouldPropagate: CMAttachmentMode = 1;

extern "C-unwind" {
    /// Sets or adds an attachment to an attachment bearer object.
    ///
    /// Parameters:
    /// - target: The `CMAttachmentBearer` object on which to add or set attachments.
    ///
    /// - key: A `CFString` key identifying the desired attachment.
    ///
    /// - value: A Core Foundation object attachment. If this parameter is `NULL`, the function returns an error.
    ///
    /// - attachmentMode: Specifies the attachment mode for this attachment. Any given attachment key may exist in only one mode at a time.
    ///
    ///
    /// ## Discussion
    ///
    /// You can attach any Core Foundation object to a `CMAttachmentBearer` object to store additional information. `CMSetAttachment` stores an attachment identified by a key. If the key doesn’t currently exist for the `CMAttachmentBearer` object when you call this function, the function adds the new attachment. If the key does exist, the function replaces the existing attachment. In both cases the function increments the retain count of the attachment. The value can be any `CFType` but a `NULL` value results in an error. Given a [`CVBufferRef`](https://developer.apple.com/documentation/corevideo/cvbuffer), `CMSetAttachment` is equivalent to `CVBufferSetAttachment`.
    ///
    ///
    /// Sets or adds a attachment of a CMAttachmentBearer
    ///
    /// You can attach any CF object to a CMAttachmentBearer object to store additional information. CMSetAttachment stores an attachment identified by a key. If the key doesn't exist, the attachment will be added. If the key does exist, the existing attachment will be replaced. In both cases the retain count of the attachment will be incremented. The value can be any CFType but nil has no defined behavior.  Given a CVBufferRef, CMSetAttachment is equivalent to CVBufferSetAttachment.
    ///
    /// Parameter `target`: Target CMAttachmentBearer.
    ///
    /// Parameter `key`: Key in form of a CFString identifying the desired attachment.
    ///
    /// Parameter `value`: Attachment in form af a CF object.
    ///
    /// Parameter `attachmentMode`: Specifies which attachment mode is desired for this attachment.   A particular attachment key may only exist in
    /// a single mode at a time.
    ///
    /// # Safety
    ///
    /// - `target` should be of the correct type.
    /// - `value` should be of the correct type.
    pub fn CMSetAttachment(
        target: &CMAttachmentBearer,
        key: &CFString,
        value: Option<&CFType>,
        attachment_mode: CMAttachmentMode,
    );
}

/// Returns an attachment from an attachment bearer object.
///
/// Parameters:
/// - target: Specifies the `CMAttachmentBearer` whose attachment you want to retrieve.
///
/// - key: Key in the form of a `CFString` identifying the desired attachment.
///
/// - attachmentModeOut: On output, `attachmentMode` points to the mode of the attachment. See [`CMAttachmentMode`](https://developer.apple.com/documentation/coremedia/cmattachmentmode)for possible values. May be `NULL`.
///
///
/// ## Return Value
///
/// The requested attachment object or `NULL` if not found.
///
///
///
/// ## Discussion
///
/// You can attach any Core Foundation object to a `CMAttachmentBearer` to store additional information. `CMGetAttachment` retrieves an attachment identified by a key. Given a [`CVBufferRef`](https://developer.apple.com/documentation/corevideo/cvbuffer), `CMGetAttachment` is equivalent to [`CVBufferCopyAttachment`](https://developer.apple.com/documentation/corevideo/cvbuffercopyattachment(_:_:_:)).
///
///
/// Returns a specific attachment of a CMAttachmentBearer
///
/// You can attach any CF object to a CMAttachmentBearer to store additional information. CMGetAttachment retrieves an attachment identified by a key.  Given a CVBufferRef, CMGetAttachment is equivalent to CVBufferGetAttachment.
///
/// Parameter `target`: Target CMAttachmentBearer.
///
/// Parameter `key`: Key in form of a CFString identifying the desired attachment.
///
/// Parameter `attachmentModeOut`: Returns the mode of the attachment, if desired.  May be NULL.
///
/// Returns: If found the attachment object; else NULL.
///
/// # Safety
///
/// - `target` should be of the correct type.
/// - `attachment_mode_out` must be a valid pointer or null.
#[inline]
pub unsafe extern "C-unwind" fn CMGetAttachment(
    target: &CMAttachmentBearer,
    key: &CFString,
    attachment_mode_out: *mut CMAttachmentMode,
) -> Option<CFRetained<CFType>> {
    extern "C-unwind" {
        fn CMGetAttachment(
            target: &CMAttachmentBearer,
            key: &CFString,
            attachment_mode_out: *mut CMAttachmentMode,
        ) -> Option<NonNull<CFType>>;
    }
    let ret = unsafe { CMGetAttachment(target, key, attachment_mode_out) };
    ret.map(|ret| unsafe { CFRetained::retain(ret) })
}

extern "C-unwind" {
    /// Removes a specific attachment from an attachment bearer object.
    ///
    /// Parameters:
    /// - target: The `CMAttachmentBearer` containing the attachment to remove.
    ///
    /// - key: Key in the form of a Core Foundation string identifying the desired attachment.
    ///
    ///
    /// ## Discussion
    ///
    /// If the attachment exists, the function removes the attachment and decrements the retain count. Given a [`CVBufferRef`](https://developer.apple.com/documentation/corevideo/cvbuffer), `CMRemoveAttachment` is equivalent to `CVBufferRemoveAttachment`.
    ///
    ///
    /// Removes a specific attachment of a CMAttachmentBearer
    ///
    /// CMRemoveAttachment removes an attachment identified by a key. If found the attachment is removed and the retain count decremented.  Given a CVBufferRef, CMRemoveAttachment is equivalent to CVBufferRemoveAttachment.
    ///
    /// Parameter `target`: Target CMAttachmentBearer.
    ///
    /// Parameter `key`: Key in form of a CFString identifying the desired attachment.
    ///
    /// # Safety
    ///
    /// `target` should be of the correct type.
    pub fn CMRemoveAttachment(target: &CMAttachmentBearer, key: &CFString);
}

extern "C-unwind" {
    /// Removes all attachments from an attachment bearer object.
    ///
    /// Parameters:
    /// - target: The `CMAttachmentBearer` whose attachment you want to remove.
    ///
    ///
    /// ## Discussion
    ///
    /// While `CMRemoveAttachment` removes a specific attachment identified by a key, `CMRemoveAllAttachments` removes all attachments of a `CMAttachmentBearer` and decrements their retain counts.  Given a [`CVBufferRef`](https://developer.apple.com/documentation/corevideo/cvbuffer), `CMRemoveAllAttachments` is equivalent to `CVBufferRemoveAllAttachments`.
    ///
    ///
    /// Removes all attachments of a CMAttachmentBearer
    ///
    /// While CMRemoveAttachment removes a specific attachment identified by a key CMRemoveAllAttachments removes all attachments of a buffer and decrements their retain counts.  Given a CVBufferRef, CMRemoveAllAttachments is equivalent to CVBufferRemoveAllAttachments.
    ///
    /// Parameter `target`: Target CMAttachmentBearer.
    ///
    /// # Safety
    ///
    /// `target` should be of the correct type.
    pub fn CMRemoveAllAttachments(target: &CMAttachmentBearer);
}

/// Returns a dictionary of all attachments for an attachment bearer object.
///
/// Parameters:
/// - allocator: Allocator for the new dictionary; pass [`kCFAllocatorDefault`](https://developer.apple.com/documentation/corefoundation/kcfallocatordefault) or `NULL` to use the default allocator.
///
/// - target: Specifies the [`CMAttachmentBearerRef`](https://developer.apple.com/documentation/coremedia/cmattachmentbearer) whose attachments you want to obtain.
///
/// - attachmentMode: The mode of the attachments you want to obtain. See [`CMAttachmentMode`](https://developer.apple.com/documentation/coremedia/cmattachmentmode) for possible values.
///
///
/// ## Return Value
///
/// A Core Foundation dictionary with all attachments identified by their keys. If no attachment is present, the dictionary is empty. Returns `NULL` for an invalid attachment mode.
///
///
///
/// ## Discussion
///
/// `CMCopyDictionaryOfAttachments` is a convenience call that returns all attachments with their corresponding keys in a new [`CFDictionaryRef`](https://developer.apple.com/documentation/corefoundation/cfdictionary). Given a `CVBufferRef`, `CMCopyDictionaryOfAttachments` is similar to `CVBufferGetAttachments`, except that the `CFDictionary` that `CMCopyDictionaryOfAttachments` returns isn’t updated for later changes to the attachments.
///
///
/// Returns all attachments of a CMAttachmentBearer
///
/// CMCopyDictionaryOfAttachments is a convenience call that returns all attachments with their corresponding keys in a new CFDictionary that the caller must dispose by calling CFRelease.  Given a CVBufferRef, CMCopyDictionaryOfAttachments is similar to CVBufferGetAttachments, except that CVBufferGetAttachments returns a CFDictionary that may change if attachments are added later.
///
/// Parameter `allocator`: Allocator for the new dictionary; pass kCFAllocatorDefault or NULL to use the default allocator.
///
/// Parameter `target`: Target CMAttachmentBearer.
///
/// Returns: A CFDictionary with all buffer attachments identified by there keys. If no attachment is present, NULL is returned.  Returns NULL
/// for invalid attachment mode.
///
/// # Safety
///
/// `target` should be of the correct type.
#[inline]
pub unsafe extern "C-unwind" fn CMCopyDictionaryOfAttachments(
    allocator: Option<&CFAllocator>,
    target: &CMAttachmentBearer,
    attachment_mode: CMAttachmentMode,
) -> Option<CFRetained<CFDictionary>> {
    extern "C-unwind" {
        fn CMCopyDictionaryOfAttachments(
            allocator: Option<&CFAllocator>,
            target: &CMAttachmentBearer,
            attachment_mode: CMAttachmentMode,
        ) -> Option<NonNull<CFDictionary>>;
    }
    let ret = unsafe { CMCopyDictionaryOfAttachments(allocator, target, attachment_mode) };
    ret.map(|ret| unsafe { CFRetained::from_raw(ret) })
}

extern "C-unwind" {
    /// Sets a dictionary of attachments on an attachment bearer object.
    ///
    /// Parameters:
    /// - target: The target `CMAttachmentBearer` to set the attachment to.
    ///
    /// - theAttachments: The attachments to set, in the form of a Core Foundation dictionary.
    ///
    /// - attachmentMode: Specifies the attachment mode for this attachment. A particular attachment key can only exist in a single mode at a time.
    ///
    ///
    /// ## Discussion
    ///
    /// `CMSetAttachments` is a convenience call that in turn calls `CMSetAttachment` for each key and value in the given dictionary. All key value pairs must be in the root level of the dictionary.  Given a [`CVBufferRef`](https://developer.apple.com/documentation/corevideo/cvbuffer), `CMSetAttachments` is equivalent to `CVBufferSetAttachments`.
    ///
    ///
    /// Sets a set of attachments for a CMAttachmentBearer
    ///
    /// CMSetAttachments is a convenience call that in turn calls CMSetAttachment for each key and value in the given dictionary. All key value pairs must be in the root level of the dictionary.  Given a CVBufferRef, CMSetAttachments is equivalent to CVBufferSetAttachments.
    ///
    /// Parameter `target`: Target CMAttachmentBearer.
    ///
    /// # Safety
    ///
    /// - `target` should be of the correct type.
    /// - `the_attachments` generic must be of the correct type.
    /// - `the_attachments` generic must be of the correct type.
    pub fn CMSetAttachments(
        target: &CMAttachmentBearer,
        the_attachments: &CFDictionary,
        attachment_mode: CMAttachmentMode,
    );
}

extern "C-unwind" {
    /// Copies all propagable attachments from one attachment bearer object to another.
    ///
    /// Parameters:
    /// - source: `CMAttachmentBearer` to copy attachments from.
    ///
    /// - destination: `CMAttachmentBearer` to copy attachments to.
    ///
    ///
    /// ## Discussion
    ///
    /// `CMPropagateAttachments` is a convenience call that copies all attachments with a mode of `kCMAttachmentMode_ShouldPropagate` from one buffer to another.  Given a [`CVBufferRef`](https://developer.apple.com/documentation/corevideo/cvbuffer), `CMPropagateAttachments` is equivalent to `CVBufferPropagateAttachments`.
    ///
    ///
    /// Copy all propagatable attachments from one buffer to another.
    ///
    /// CMPropagateAttachments is a convenience call that copies all attachments with a mode of kCMAttachmentMode_ShouldPropagate from one
    /// buffer to another.  Given a CVBufferRef, CMPropagateAttachments is equivalent to CVBufferPropagateAttachments.
    ///
    /// Parameter `source`: CMAttachmentBearer to copy attachments from.
    ///
    /// Parameter `destination`: CMAttachmentBearer to copy attachments to.
    ///
    /// # Safety
    ///
    /// - `source` should be of the correct type.
    /// - `destination` should be of the correct type.
    pub fn CMPropagateAttachments(source: &CMAttachmentBearer, destination: &CMAttachmentBearer);
}
