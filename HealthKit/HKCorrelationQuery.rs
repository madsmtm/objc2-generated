//! This file has been automatically generated by `objc2`'s `header-translator`.
//! DO NOT EDIT
use core::ffi::*;
use core::ptr::NonNull;
use objc2::__framework_prelude::*;
use objc2_foundation::*;

use crate::*;

extern_class!(
    /// A query that performs complex searches based on the correlation’s contents, and returns a snapshot of all matching samples.
    ///
    /// ## Overview
    ///
    /// Correlation samples act as a container, grouping multiple quantity or category samples. While you can use [`HKSample`](https://developer.apple.com/documentation/healthkit/hksample) objects to search for correlations, correlation queries allow more complex filtering based on the contained samples. Specifically, correlation queries let you provide a separate predicate for each of the sample types stored in the correlation. A correlation is  returned only if the correlation’s predicate and all of the sample predicates match.
    ///
    /// ### Requesting Permission to Share and Read
    ///
    /// Unlike other sample types, you do not request permission to share and read correlation types directly. Instead, you request permission to share and read each of the sample types contained within the correlation.
    ///
    /// When saving a correlation, the app must have permission to share all of the contained objects. If the app does not have permission to share one or more of the contained objects, the operation fails.
    ///
    /// When your app queries for correlation data, HealthKit only returns samples that contain objects you have permission to read. If the app has permission to read only some of the contained objects, HealthKit still returns the correlation; however, the correlation appears to only contain those objects that your app has permission to read. HealthKit hides all of the other contained objects from your app.
    ///
    /// ### Executing Queries
    ///
    /// You create a correlation query by calling the [`initWithType:predicate:samplePredicates:completion:`](https://developer.apple.com/documentation/healthkit/hkcorrelationquery/init(type:predicate:samplepredicates:completion:)) initializer. After the query is instantiated, you run it by calling the HealthKit store’s [`executeQuery:`](https://developer.apple.com/documentation/healthkit/hkhealthstore/execute(_:)) method. This method runs the query on an anonymous background queue. When the query is complete, it executes the results handler on the same background queue (though not necessarily the same thread). Typically, you dispatch these results back to the main thread to update your user interface.
    ///
    /// The following example builds a correlation query that searches for food samples with more than 800 calories.
    ///
    /// (TODO tabnav: TabNavigator { tabs: [TabItem { title: "Swift", content: [CodeListing { syntax: Some("swift"), code: ["var highCalorieFoods: [HKCorrelationQuery] = []", " ", "let highCalorie = HKQuantity(unit: HKUnit.kilocalorieUnit(),", "                             doubleValue: 800.0);", " ", "let greaterThanHighCalorie = HKQuery.predicateForQuantitySamplesWithOperatorType(", "    .GreaterThanOrEqualToPredicateOperatorType, quantity: highCalorie)", " ", "let energyConsumed = HKObjectType.quantityTypeForIdentifier(", "    HKQuantityTypeIdentifierDietaryEnergyConsumed)", " ", "let samplePredicates = [energyConsumed: greaterThanHighCalorie]", " ", "let foodType = HKCorrelationType.correlationTypeForIdentifier(", "    HKCorrelationTypeIdentifierFood)", " ", "let query = HKCorrelationQuery(type: foodType, predicate: nil, samplePredicates: samplePredicates)", "{", "    query, results, error in", "    ", "    if let correlations = results as? [HKCorrelationQuery] {", "        for correlation in correlations {", "            highCalorieFoods.append(correlation)", "        }", "    }", "    else {", "        // Provide proper error handling here...", "        println(\"An error occurred while searching for high calorie food: \\(error.localizedDescription)\")", "        abort()", "    }", "    ", "    println(\"Found \\(highCalorieFoods.count) foods: \\(highCalorieFoods)\")", "}", " ", "healthStore.executeQuery(query)"], metadata: None }] }, TabItem { title: "Objective-C", content: [CodeListing { syntax: Some("objc"), code: ["NSMutableArray *highCalorieFoods = [NSMutableArray array];", "HKQuantity *highCalorie = [HKQuantity quantityWithUnit:[HKUnit kilocalorieUnit]", "                                           doubleValue:800.0];", " ", "NSPredicate *greaterThanHighCalorie =", "[HKQuery predicateForQuantitySamplesWithOperatorType:", " NSGreaterThanOrEqualToPredicateOperatorType quantity:highCalorie];", " ", "HKQuantityType *energyConsumed =", "[HKObjectType quantityTypeForIdentifier:", " HKQuantityTypeIdentifierDietaryEnergyConsumed];", " ", "NSDictionary *samplePredicates = @{energyConsumed : greaterThanHighCalorie};", " ", "HKCorrelationType *foodType =", "[HKCorrelationType correlationTypeForIdentifier:HKCorrelationTypeIdentifierFood];", " ", "HKCorrelationQuery *query =", "[[HKCorrelationQuery alloc]", " initWithType:foodType predicate:nil", " samplePredicates:samplePredicates", " completion:^(HKCorrelationQuery *query, NSArray *correlations, NSError *error) {", "     if (correlations == nil) {", "         // Provide proper error handling here...", "         NSLog(@\"An error occurred while searching for high calorie food: %@\",", "              error.localizedDescription);", "         abort();", "     }", "     for (HKCorrelation *correlation in correlations) {", "         [highCalorieFoods addObject:correlation];", "     }", "     NSLog(@\"Found %lu foods: %@\", (unsigned long)[highCalorieFoods count], highCalorieFoods);", " ", " }];", " ", "[self.healthStore executeQuery:query];"], metadata: None }] }] })
    /// It begins by setting up an array to store our high calorie foods. Next, the sample code creates a predicate that matches quantities greater than or equal to 800 kcal. It then creates a dictionary using a quantity type object for dietary energy consumed as the key and the newly-created predicate as the value. It uses this dictionary as the sample predicates for a correlation query.
    ///
    /// In the query’s completion handler, the sample code first checks to see if an error occurred. If no errors occurred, it adds the results to the array of high calorie foods. Then it logs the number of matching samples found, and the contents of the high calorie foods array.
    ///
    /// Once the sample code finishes declaring the completion handler, the query is ready to use. The sample code simply executes the query on the HeathKit store.
    ///
    /// ### Subclassing Correlation Queries
    ///
    /// Like many HealthKit classes, the `HKCorrelationQuery` class should not be subclassed.
    ///
    ///
    /// A query to find HKCorrelations
    ///
    /// Correlations are HKSamples that contain a set of correlated samples. HKCorrelationQuery
    /// accepts a predicate to filter HKCorrelations and a dictionary of predicates to filter the
    /// correlated samples.
    #[unsafe(super(HKQuery, NSObject))]
    #[derive(Debug, PartialEq, Eq, Hash)]
    #[cfg(feature = "HKQuery")]
    pub struct HKCorrelationQuery;
);

#[cfg(feature = "HKQuery")]
unsafe impl Send for HKCorrelationQuery {}

#[cfg(feature = "HKQuery")]
unsafe impl Sync for HKCorrelationQuery {}

#[cfg(feature = "HKQuery")]
extern_conformance!(
    unsafe impl NSObjectProtocol for HKCorrelationQuery {}
);

#[cfg(feature = "HKQuery")]
impl HKCorrelationQuery {
    extern_methods!(
        #[cfg(feature = "HKObjectType")]
        #[unsafe(method(correlationType))]
        #[unsafe(method_family = none)]
        pub unsafe fn correlationType(&self) -> Retained<HKCorrelationType>;

        #[cfg(feature = "HKObjectType")]
        /// A dictionary of predicates for the HKCorrelation's objects
        ///
        /// samplePredicates maps HKSampleTypes to NSPredicates. The predicate value will apply
        /// to objects of the key type.
        #[unsafe(method(samplePredicates))]
        #[unsafe(method_family = none)]
        pub unsafe fn samplePredicates(
            &self,
        ) -> Option<Retained<NSDictionary<HKSampleType, NSPredicate>>>;

        #[cfg(all(
            feature = "HKCorrelation",
            feature = "HKObject",
            feature = "HKObjectType",
            feature = "HKSample",
            feature = "block2"
        ))]
        /// The designated initializer for HKCorrelationQuery.
        ///
        ///
        /// Parameter `correlationType`: The type of correlation that is being queried for
        ///
        ///
        /// Parameter `predicate`: The predicate for scoping which HKCorrelations are returned
        ///
        ///
        /// Parameter `samplePredicates`: A dictionary mapping HKSampleTypes to NSPredicates. If no predicate for a particular type
        /// is provided, it is assumed to be a nil predicate and objects of that type will not be
        /// filtered.
        ///
        /// # Safety
        ///
        /// `completion` block must be sendable.
        #[unsafe(method(initWithType:predicate:samplePredicates:completion:))]
        #[unsafe(method_family = init)]
        pub unsafe fn initWithType_predicate_samplePredicates_completion(
            this: Allocated<Self>,
            correlation_type: &HKCorrelationType,
            predicate: Option<&NSPredicate>,
            sample_predicates: Option<&NSDictionary<HKSampleType, NSPredicate>>,
            completion: &block2::DynBlock<
                dyn Fn(NonNull<HKCorrelationQuery>, *mut NSArray<HKCorrelation>, *mut NSError),
            >,
        ) -> Retained<Self>;
    );
}

/// Methods declared on superclass `HKQuery`.
#[cfg(feature = "HKQuery")]
impl HKCorrelationQuery {
    extern_methods!(
        #[unsafe(method(init))]
        #[unsafe(method_family = init)]
        pub unsafe fn init(this: Allocated<Self>) -> Retained<Self>;
    );
}

/// Methods declared on superclass `NSObject`.
#[cfg(feature = "HKQuery")]
impl HKCorrelationQuery {
    extern_methods!(
        #[unsafe(method(new))]
        #[unsafe(method_family = new)]
        pub unsafe fn new() -> Retained<Self>;
    );
}
