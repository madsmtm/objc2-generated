//! This file has been automatically generated by `objc2`'s `header-translator`.
//! DO NOT EDIT
use core::cell::UnsafeCell;
use core::ffi::*;
use core::marker::{PhantomData, PhantomPinned};
use core::ptr::NonNull;
#[cfg(feature = "objc2")]
use objc2::__framework_prelude::*;
use objc2_core_foundation::*;

use crate::*;

/// A reference to a pixel buffer pool object.
///
/// ## Overview
///
/// CVPixelBufferPool is a utility object for managing a recyclable set of [`CVPixelBufferRef`](https://developer.apple.com/documentation/corevideo/cvpixelbuffer) objects.
///
///
#[doc(alias = "CVPixelBufferPoolRef")]
#[repr(C)]
pub struct CVPixelBufferPool {
    inner: [u8; 0],
    _p: UnsafeCell<PhantomData<(*const UnsafeCell<()>, PhantomPinned)>>,
}

cf_type!(
    unsafe impl CVPixelBufferPool {}
);
#[cfg(feature = "objc2")]
cf_objc2_type!(
    unsafe impl RefEncode<"__CVPixelBufferPool"> for CVPixelBufferPool {}
);

extern "C" {
    /// The minimum number of buffers allowed in the pixel buffer pool.
    ///
    /// ## Discussion
    ///
    /// This value for this key is of type [`CFNumberRef`](https://developer.apple.com/documentation/corefoundation/cfnumber).
    ///
    ///
    pub static kCVPixelBufferPoolMinimumBufferCountKey: &'static CFString;
}

extern "C" {
    /// The key you use to set the maximum allowable age for a buffer in the pixel buffer pool.
    ///
    /// ## Discussion
    ///
    /// This value for this key is of type [`CFAbsoluteTime`](https://developer.apple.com/documentation/corefoundation/cfabsolutetime).
    ///
    ///
    pub static kCVPixelBufferPoolMaximumBufferAgeKey: &'static CFString;
}

unsafe impl ConcreteType for CVPixelBufferPool {
    /// Returns the Core Foundation type identifier of the pixel buffer pool type.
    ///
    /// ## Return Value
    ///
    /// The Core Foundation type identifier for this pixel buffer.
    ///
    ///
    #[doc(alias = "CVPixelBufferPoolGetTypeID")]
    #[inline]
    fn type_id() -> CFTypeID {
        extern "C-unwind" {
            fn CVPixelBufferPoolGetTypeID() -> CFTypeID;
        }
        unsafe { CVPixelBufferPoolGetTypeID() }
    }
}

impl CVPixelBufferPool {
    /// Creates a pixel buffer pool using the allocator and attributes that you specify.
    ///
    /// Parameters:
    /// - allocator: The allocator to use for creating the buffer pool. Pass [`kCFAllocatorDefault`](https://developer.apple.com/documentation/corefoundation/kcfallocatordefault) to use the default allocator. See [Predefined Allocators](https://developer.apple.com/documentation/corefoundation/predefined-allocators) for additional values you can use.
    ///
    /// - poolAttributes: A Core Foundation dictionary that contains the attributes for the pixel buffer pool. See the Constants topic group below for possible values.
    ///
    /// - pixelBufferAttributes: An optional dictionary that contains the attributes to use to create new pixel buffers within the pool. See [Pixel Buffer Attribute Keys](https://developer.apple.com/documentation/corevideo/pixel-buffer-attribute-keys) for possible values.
    ///
    /// - poolOut: On output, the newly created pixel buffer pool.
    ///
    ///
    /// ## Return Value
    ///
    /// A Core Video result code. See [Result Codes](https://developer.apple.com/documentation/corevideo/result-codes) for possible values.
    ///
    ///
    ///
    /// ## Discussion
    ///
    /// Use [`CVPixelBufferPoolRelease`](https://developer.apple.com/documentation/corevideo/cvpixelbufferpoolrelease) to release ownership of the `poolOut` object when you’re done with it.
    ///
    ///
    /// Creates a new Pixel Buffer pool.
    ///
    /// Parameter `allocator`: The CFAllocatorRef to use for allocating this buffer pool.  May be NULL.
    ///
    /// Parameter `attributes`: A CFDictionaryRef containing the attributes to be used for creating new PixelBuffers within the pool.
    ///
    /// Parameter `poolOut`: The newly created pool will be placed here
    ///
    /// Returns: Returns kCVReturnSuccess on success
    ///
    /// # Safety
    ///
    /// - `pool_attributes` generic must be of the correct type.
    /// - `pool_attributes` generic must be of the correct type.
    /// - `pixel_buffer_attributes` generic must be of the correct type.
    /// - `pixel_buffer_attributes` generic must be of the correct type.
    /// - `pool_out` must be a valid pointer.
    #[doc(alias = "CVPixelBufferPoolCreate")]
    #[cfg(feature = "CVReturn")]
    #[inline]
    pub unsafe fn create(
        allocator: Option<&CFAllocator>,
        pool_attributes: Option<&CFDictionary>,
        pixel_buffer_attributes: Option<&CFDictionary>,
        pool_out: NonNull<*mut CVPixelBufferPool>,
    ) -> CVReturn {
        extern "C-unwind" {
            fn CVPixelBufferPoolCreate(
                allocator: Option<&CFAllocator>,
                pool_attributes: Option<&CFDictionary>,
                pixel_buffer_attributes: Option<&CFDictionary>,
                pool_out: NonNull<*mut CVPixelBufferPool>,
            ) -> CVReturn;
        }
        unsafe {
            CVPixelBufferPoolCreate(
                allocator,
                pool_attributes,
                pixel_buffer_attributes,
                pool_out,
            )
        }
    }

    /// The pool attributes dictionary for a pixel buffer pool.
    ///
    /// Parameters:
    /// - pool: The pixel buffer pool that contains the attributes to retrieve.
    ///
    ///
    /// ## Return Value
    ///
    /// A Core Foundation dictionary containing the pool attributes, or [`nil`](https://developer.apple.com/documentation/objectivec/nil-227m0) if the function fails.
    ///
    ///
    /// Returns the pool attributes dictionary for a CVPixelBufferPool
    ///
    /// Parameter `pool`: The CVPixelBufferPoolRef to retrieve the attributes from
    ///
    /// Returns: Returns the pool attributes dictionary, or NULL on failure.
    #[doc(alias = "CVPixelBufferPoolGetAttributes")]
    #[inline]
    pub fn attributes(&self) -> Option<CFRetained<CFDictionary>> {
        extern "C-unwind" {
            fn CVPixelBufferPoolGetAttributes(
                pool: &CVPixelBufferPool,
            ) -> Option<NonNull<CFDictionary>>;
        }
        let ret = unsafe { CVPixelBufferPoolGetAttributes(self) };
        ret.map(|ret| unsafe { CFRetained::retain(ret) })
    }

    /// The attributes of pixel buffers which the system creates using the pool you specify.
    ///
    /// Parameters:
    /// - pool: The pixel buffer pool that contains the attributes to retrieve.
    ///
    ///
    /// ## Return Value
    ///
    /// A Core Foundation dictionary containing the pool attributes, or [`nil`](https://developer.apple.com/documentation/objectivec/nil-227m0) if the function fails.
    ///
    ///
    ///
    /// ## Discussion
    ///
    /// Use this function to obtain information about the pixel buffers which the system creates using the pool you specify, before the system creates those pixel buffers.
    ///
    ///
    /// Returns the attributes of pixel buffers that will be created from this pool.
    ///
    /// This function is provided for those cases where you may need to know some information about the buffers that
    /// will be created up front.
    ///
    /// Parameter `pool`: The CVPixelBufferPoolRef to retrieve the attributes from
    ///
    /// Returns: Returns the pixel buffer attributes dictionary, or NULL on failure.
    #[doc(alias = "CVPixelBufferPoolGetPixelBufferAttributes")]
    #[inline]
    pub fn pixel_buffer_attributes(&self) -> Option<CFRetained<CFDictionary>> {
        extern "C-unwind" {
            fn CVPixelBufferPoolGetPixelBufferAttributes(
                pool: &CVPixelBufferPool,
            ) -> Option<NonNull<CFDictionary>>;
        }
        let ret = unsafe { CVPixelBufferPoolGetPixelBufferAttributes(self) };
        ret.map(|ret| unsafe { CFRetained::retain(ret) })
    }

    /// Creates a pixel buffer from a pixel buffer pool, using the allocator that you specify.
    ///
    /// Parameters:
    /// - allocator: The allocator to use for creating the pixel buffer. Pass [`kCFAllocatorDefault`](https://developer.apple.com/documentation/corefoundation/kcfallocatordefault) to use the default allocator. See [Predefined Allocators](https://developer.apple.com/documentation/corefoundation/predefined-allocators) for additional values you can use.
    ///
    /// - pixelBufferPool: The pixel buffer pool for creating the new pixel buffer.
    ///
    /// - pixelBufferOut: On output, the newly created pixel buffer.
    ///
    ///
    /// ## Return Value
    ///
    /// A Core Video result code. See [Result Codes](https://developer.apple.com/documentation/corevideo/result-codes) for possible values.
    ///
    ///
    ///
    /// ## Discussion
    ///
    /// This function creates a new pixel buffer using the pixel buffer attributes specified during pool creation. This buffer has default attachments as specified in the `pixelBufferAttributes` parameter of [`CVPixelBufferPoolCreate`](https://developer.apple.com/documentation/corevideo/cvpixelbufferpoolcreate(_:_:_:_:)), using either the [`kCVBufferPropagatedAttachmentsKey`](https://developer.apple.com/documentation/corevideo/kcvbufferpropagatedattachmentskey) or [`kCVBufferNonPropagatedAttachmentsKey`](https://developer.apple.com/documentation/corevideo/kcvbuffernonpropagatedattachmentskey) attributes.
    ///
    ///
    /// Creates a new PixelBuffer object from the pool.
    ///
    /// The function creates a new (attachment-free) CVPixelBuffer using the pixel buffer attributes specifed during pool creation.
    ///
    /// Parameter `allocator`: The CFAllocatorRef to use for creating the pixel buffer.  May be NULL.
    ///
    /// Parameter `pool`: The CVPixelBufferPool that should create the new CVPixelBuffer.
    ///
    /// Parameter `pixelBufferOut`: The newly created pixel buffer will be placed here
    ///
    /// Returns: Returns kCVReturnSuccess on success
    ///
    /// # Safety
    ///
    /// `pixel_buffer_out` must be a valid pointer.
    #[doc(alias = "CVPixelBufferPoolCreatePixelBuffer")]
    #[cfg(all(
        feature = "CVBuffer",
        feature = "CVImageBuffer",
        feature = "CVPixelBuffer",
        feature = "CVReturn"
    ))]
    #[inline]
    pub unsafe fn create_pixel_buffer(
        allocator: Option<&CFAllocator>,
        pixel_buffer_pool: &CVPixelBufferPool,
        pixel_buffer_out: NonNull<*mut CVPixelBuffer>,
    ) -> CVReturn {
        extern "C-unwind" {
            fn CVPixelBufferPoolCreatePixelBuffer(
                allocator: Option<&CFAllocator>,
                pixel_buffer_pool: &CVPixelBufferPool,
                pixel_buffer_out: NonNull<*mut CVPixelBuffer>,
            ) -> CVReturn;
        }
        unsafe {
            CVPixelBufferPoolCreatePixelBuffer(allocator, pixel_buffer_pool, pixel_buffer_out)
        }
    }

    /// Creates a new pixel buffer with auxiliary attributes from the pool.
    ///
    /// Parameters:
    /// - allocator: The allocator to use for creating the buffer pool. Pass [`kCFAllocatorDefault`](https://developer.apple.com/documentation/corefoundation/kcfallocatordefault) to use the default allocator. See [Predefined Allocators](https://developer.apple.com/documentation/corefoundation/predefined-allocators) for additional values you can use.
    ///
    /// - pixelBufferPool: The pixel buffer pool for creating the new pixel buffer.
    ///
    /// - auxAttributes: An optional dictionary of auxiliary attributes that describes the allocation request. See the Constants topic group below for possible values.
    ///
    /// - pixelBufferOut: On output, the newly created pixel buffer.
    ///
    ///
    /// ## Return Value
    ///
    /// A Core Video result code. See [Result Codes](https://developer.apple.com/documentation/corevideo/result-codes) for possible values.
    ///
    ///
    ///
    /// ## Discussion
    ///
    /// This function creates a new [`CVPixelBufferRef`](https://developer.apple.com/documentation/corevideo/cvpixelbuffer) object using the pixel buffer attributes specified during pool creation and the attributes specified in the `auxAttributes` parameter.
    ///
    ///
    ///
    /// # Safety
    ///
    /// - `aux_attributes` generic must be of the correct type.
    /// - `aux_attributes` generic must be of the correct type.
    /// - `pixel_buffer_out` must be a valid pointer.
    #[doc(alias = "CVPixelBufferPoolCreatePixelBufferWithAuxAttributes")]
    #[cfg(all(
        feature = "CVBuffer",
        feature = "CVImageBuffer",
        feature = "CVPixelBuffer",
        feature = "CVReturn"
    ))]
    #[inline]
    pub unsafe fn create_pixel_buffer_with_aux_attributes(
        allocator: Option<&CFAllocator>,
        pixel_buffer_pool: &CVPixelBufferPool,
        aux_attributes: Option<&CFDictionary>,
        pixel_buffer_out: NonNull<*mut CVPixelBuffer>,
    ) -> CVReturn {
        extern "C-unwind" {
            fn CVPixelBufferPoolCreatePixelBufferWithAuxAttributes(
                allocator: Option<&CFAllocator>,
                pixel_buffer_pool: &CVPixelBufferPool,
                aux_attributes: Option<&CFDictionary>,
                pixel_buffer_out: NonNull<*mut CVPixelBuffer>,
            ) -> CVReturn;
        }
        unsafe {
            CVPixelBufferPoolCreatePixelBufferWithAuxAttributes(
                allocator,
                pixel_buffer_pool,
                aux_attributes,
                pixel_buffer_out,
            )
        }
    }
}

extern "C" {
    /// The key you use to set the auxiliary attributes dictionary.
    ///
    /// ## Discussion
    ///
    /// Use this key to set `auxAttributes` in [`CVPixelBufferPoolCreatePixelBufferWithAuxAttributes`](https://developer.apple.com/documentation/corevideo/cvpixelbufferpoolcreatepixelbufferwithauxattributes(_:_:_:_:)).
    ///
    /// The value for this key specifies that the system shouldn’t allocate a new pixel buffer if the pool already holds at least the specified number of allocated pixel buffers. This key doesn’t prevent the system from recycling allocated buffers. If this key causes [`CVPixelBufferPoolCreatePixelBufferWithAuxAttributes`](https://developer.apple.com/documentation/corevideo/cvpixelbufferpoolcreatepixelbufferwithauxattributes(_:_:_:_:)) to fail, it returns the [`kCVReturnWouldExceedAllocationThreshold`](https://developer.apple.com/documentation/corevideo/kcvreturnwouldexceedallocationthreshold) result code.
    ///
    ///
    pub static kCVPixelBufferPoolAllocationThresholdKey: &'static CFString;
}

extern "C" {
    /// A notification that the system posts if a buffer becomes available after it fails to create a pixel buffer with auxiliary attributes because it exceeded the threshold you specified.
    ///
    /// ## Discussion
    ///
    /// The system posts this notification if a buffer becomes available after the [`CVPixelBufferPoolCreatePixelBufferWithAuxAttributes`](https://developer.apple.com/documentation/corevideo/cvpixelbufferpoolcreatepixelbufferwithauxattributes(_:_:_:_:)) function fails because the system exceeds the threshold you set for the [`kCVPixelBufferPoolAllocationThresholdKey`](https://developer.apple.com/documentation/corevideo/kcvpixelbufferpoolallocationthresholdkey) key. The system won’t post this notification if you don’t set a value for the [`kCVPixelBufferPoolAllocationThresholdKey`](https://developer.apple.com/documentation/corevideo/kcvpixelbufferpoolallocationthresholdkey) key for the `auxAttributes` parameter of the [`CVPixelBufferPoolCreatePixelBufferWithAuxAttributes`](https://developer.apple.com/documentation/corevideo/cvpixelbufferpoolcreatepixelbufferwithauxattributes(_:_:_:_:)) function.
    ///
    ///
    pub static kCVPixelBufferPoolFreeBufferNotification: &'static CFString;
}

/// The flags to pass to flush the pool.
/// Flags to pass to CVPixelBufferPoolFlush()
///
/// This flag will cause CVPixelBufferPoolFlush to flush all unused buffers regardless of age.
// NS_OPTIONS
#[cfg(feature = "CVBase")]
#[repr(transparent)]
#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, PartialOrd, Ord, Default)]
pub struct CVPixelBufferPoolFlushFlags(pub CVOptionFlags);
#[cfg(feature = "CVBase")]
bitflags::bitflags! {
    impl CVPixelBufferPoolFlushFlags: CVOptionFlags {
/// The value to pass to flush all unused buffers regardless of age.
        #[doc(alias = "kCVPixelBufferPoolFlushExcessBuffers")]
        const ExcessBuffers = 1;
    }
}

#[cfg(all(feature = "CVBase", feature = "objc2"))]
unsafe impl Encode for CVPixelBufferPoolFlushFlags {
    const ENCODING: Encoding = CVOptionFlags::ENCODING;
}

#[cfg(all(feature = "CVBase", feature = "objc2"))]
unsafe impl RefEncode for CVPixelBufferPoolFlushFlags {
    const ENCODING_REF: Encoding = Encoding::Pointer(&Self::ENCODING);
}

impl CVPixelBufferPool {
    /// Frees pixel buffers from the pool based on the options that you specify.
    ///
    /// Parameters:
    /// - pool: The pixel buffer pool to free.
    ///
    /// - options: Set to [`kCVPixelBufferPoolFlushExcessBuffers`](https://developer.apple.com/documentation/corevideo/cvpixelbufferpoolflushflags/excessbuffers) to free all unused buffers regardless of their age. Pass an empty set to free only all aged-out buffers, or set it to [`kCVPixelBufferPoolFlushExcessBuffers`](https://developer.apple.com/documentation/corevideo/cvpixelbufferpoolflushflags/excessbuffers) to free all unused buffers regardless of age.
    ///
    /// Frees as many buffers from the pool as possible.
    ///
    /// By default, this function will free all aged out buffers.  Setting the
    /// kCVPixelBufferPoolFlushExcessBuffers flag will cause this call to free all unused
    /// buffers regardless of age.
    ///
    /// Parameter `pool`: The CVPixelBufferPool to be flushed.
    ///
    /// Parameter `options`: Set to kCVPixelBufferPoolFlushExcessBuffers to free all unused buffers
    /// regardless of their age.
    #[doc(alias = "CVPixelBufferPoolFlush")]
    #[cfg(feature = "CVBase")]
    #[inline]
    pub fn flush(&self, options: CVPixelBufferPoolFlushFlags) {
        extern "C-unwind" {
            fn CVPixelBufferPoolFlush(
                pool: &CVPixelBufferPool,
                options: CVPixelBufferPoolFlushFlags,
            );
        }
        unsafe { CVPixelBufferPoolFlush(self, options) }
    }
}

extern "C-unwind" {
    #[cfg(feature = "CVReturn")]
    #[deprecated = "renamed to `CVPixelBufferPool::create`"]
    pub fn CVPixelBufferPoolCreate(
        allocator: Option<&CFAllocator>,
        pool_attributes: Option<&CFDictionary>,
        pixel_buffer_attributes: Option<&CFDictionary>,
        pool_out: NonNull<*mut CVPixelBufferPool>,
    ) -> CVReturn;
}

#[deprecated = "renamed to `CVPixelBufferPool::attributes`"]
#[inline]
pub extern "C-unwind" fn CVPixelBufferPoolGetAttributes(
    pool: &CVPixelBufferPool,
) -> Option<CFRetained<CFDictionary>> {
    extern "C-unwind" {
        fn CVPixelBufferPoolGetAttributes(
            pool: &CVPixelBufferPool,
        ) -> Option<NonNull<CFDictionary>>;
    }
    let ret = unsafe { CVPixelBufferPoolGetAttributes(pool) };
    ret.map(|ret| unsafe { CFRetained::retain(ret) })
}

#[deprecated = "renamed to `CVPixelBufferPool::pixel_buffer_attributes`"]
#[inline]
pub extern "C-unwind" fn CVPixelBufferPoolGetPixelBufferAttributes(
    pool: &CVPixelBufferPool,
) -> Option<CFRetained<CFDictionary>> {
    extern "C-unwind" {
        fn CVPixelBufferPoolGetPixelBufferAttributes(
            pool: &CVPixelBufferPool,
        ) -> Option<NonNull<CFDictionary>>;
    }
    let ret = unsafe { CVPixelBufferPoolGetPixelBufferAttributes(pool) };
    ret.map(|ret| unsafe { CFRetained::retain(ret) })
}

extern "C-unwind" {
    #[cfg(all(
        feature = "CVBuffer",
        feature = "CVImageBuffer",
        feature = "CVPixelBuffer",
        feature = "CVReturn"
    ))]
    #[deprecated = "renamed to `CVPixelBufferPool::create_pixel_buffer`"]
    pub fn CVPixelBufferPoolCreatePixelBuffer(
        allocator: Option<&CFAllocator>,
        pixel_buffer_pool: &CVPixelBufferPool,
        pixel_buffer_out: NonNull<*mut CVPixelBuffer>,
    ) -> CVReturn;
}

extern "C-unwind" {
    #[cfg(all(
        feature = "CVBuffer",
        feature = "CVImageBuffer",
        feature = "CVPixelBuffer",
        feature = "CVReturn"
    ))]
    #[deprecated = "renamed to `CVPixelBufferPool::create_pixel_buffer_with_aux_attributes`"]
    pub fn CVPixelBufferPoolCreatePixelBufferWithAuxAttributes(
        allocator: Option<&CFAllocator>,
        pixel_buffer_pool: &CVPixelBufferPool,
        aux_attributes: Option<&CFDictionary>,
        pixel_buffer_out: NonNull<*mut CVPixelBuffer>,
    ) -> CVReturn;
}

#[cfg(feature = "CVBase")]
#[deprecated = "renamed to `CVPixelBufferPool::flush`"]
#[inline]
pub extern "C-unwind" fn CVPixelBufferPoolFlush(
    pool: &CVPixelBufferPool,
    options: CVPixelBufferPoolFlushFlags,
) {
    extern "C-unwind" {
        fn CVPixelBufferPoolFlush(pool: &CVPixelBufferPool, options: CVPixelBufferPoolFlushFlags);
    }
    unsafe { CVPixelBufferPoolFlush(pool, options) }
}
