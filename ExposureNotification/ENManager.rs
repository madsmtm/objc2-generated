//! This file has been automatically generated by `objc2`'s `header-translator`.
//! DO NOT EDIT
use core::ffi::*;
use core::ptr::NonNull;
#[cfg(feature = "dispatch2")]
use dispatch2::*;
use objc2::__framework_prelude::*;
use objc2_foundation::*;

use crate::*;

/// A set of cases that represents the overall status of exposure notification on the system.
///
/// ## Overview
///
/// <div class="warning">
///
/// ### Important
///  This enumeration is available in iOS 12.5, and in iOS 13.5 and later.
///
///
///
/// </div>
///
/// Overall status of Exposure Notification on the system.
// NS_ENUM
#[repr(transparent)]
#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, PartialOrd, Ord, Default)]
pub struct ENStatus(pub NSInteger);
impl ENStatus {
    /// Notification is unknown.
    ///
    /// ## Discussion
    ///
    /// This is the status before [`ENManager`](https://developer.apple.com/documentation/exposurenotification/enmanager) has activated successfully.
    ///
    ///
    /// Status of Exposure Notification is unknown. This is the status before ENManager has activated successfully.
    #[doc(alias = "ENStatusUnknown")]
    pub const Unknown: Self = Self(0);
    /// Notification is active.
    /// Exposure Notification is active on the system.
    #[doc(alias = "ENStatusActive")]
    pub const Active: Self = Self(1);
    /// Notification is disabled.
    ///
    /// ## Discussion
    ///
    /// Use [`setExposureNotificationEnabled:completionHandler:`](https://developer.apple.com/documentation/exposurenotification/enmanager/setexposurenotificationenabled(_:completionhandler:)) to enable exposure notification.
    ///
    ///
    /// Exposure Notification is disabled. setExposureNotificationEnabled:completionHandler can be used to enable it.
    #[doc(alias = "ENStatusDisabled")]
    pub const Disabled: Self = Self(2);
    /// Bluetooth is turned off.
    ///
    /// ## Discussion
    ///
    /// Bluetooth is required for Exposure Notification. If Bluetooth is disabled, notify the user that Exposure Notification can’t work without Bluetooth enabled.
    ///
    /// <div class="warning">
    ///
    /// ### Note
    ///  This may not match the state of Bluetooth as reported by CoreBluetooth.
    ///
    ///
    ///
    /// </div>
    /// Exposure Notification is a system service and can use Bluetooth in situations when apps cannot. For the purposes of notification of exposure, it’s better to use this API instead of CoreBluetooth.
    ///
    ///
    /// Bluetooth has been turned off on the system. Bluetooth is required for Exposure Notification.
    /// Note: this may not match the state of Bluetooth as reported by CoreBluetooth.
    /// Exposure Notification is a system service and can use Bluetooth in situations when apps cannot.
    /// So for the purposes of Exposure Notification, it's better to use this API instead of CoreBluetooth.
    #[doc(alias = "ENStatusBluetoothOff")]
    pub const BluetoothOff: Self = Self(3);
    /// Notification is not active due to system restrictions, such as parental controls.
    ///
    /// ## Discussion
    ///
    /// When in this state, the app cannot enable exposure notification.
    ///
    ///
    /// Exposure Notification is not active due to system restrictions, such as parental controls.
    /// When in this state, the app cannot enable Exposure Notification.
    #[doc(alias = "ENStatusRestricted")]
    pub const Restricted: Self = Self(4);
    /// The user paused Exposure Notification.
    ///
    /// ## Discussion
    ///
    /// Don’t use this enumeration; it’s currently unsupported.
    ///
    ///
    /// For future use. Not returned by any APIs yet.
    #[doc(alias = "ENStatusPaused")]
    pub const Paused: Self = Self(5);
    /// The user hasn’t authorized Exposure Notification.
    /// Exposure Notification is not available due to insufficient authorization.
    #[doc(alias = "ENStatusUnauthorized")]
    pub const Unauthorized: Self = Self(6);
}

unsafe impl Encode for ENStatus {
    const ENCODING: Encoding = NSInteger::ENCODING;
}

unsafe impl RefEncode for ENStatus {
    const ENCODING_REF: Encoding = Encoding::Pointer(&Self::ENCODING);
}

/// Activities that occur while the app isn’t running.
///
/// ## Overview
///
/// <div class="warning">
///
/// ### Important
///  This symbol is available in iOS 12.5, and in iOS 13.6 and later.
///
///
///
/// </div>
///
/// Activities that occurred while the app might not be running.
// NS_OPTIONS
#[repr(transparent)]
#[derive(Clone, Copy, Debug, PartialEq, Eq, Hash, PartialOrd, Ord, Default)]
pub struct ENActivityFlags(pub u32);
bitflags::bitflags! {
    impl ENActivityFlags: u32 {
/// This property is reserved.
/// Reserved field
        #[doc(alias = "ENActivityFlagsReserved1")]
        const Reserved1 = 1<<0;
/// This property is reserved.
/// Reserved field
        #[doc(alias = "ENActivityFlagsReserved2")]
        const Reserved2 = 1<<1;
/// The property that specifies launching the app in the background for periodic operation in iOS 12.5.
/// The app launched in the background to perform periodic operations on iOS 12.5.
        #[doc(alias = "ENActivityFlagsPeriodicRun")]
        const PeriodicRun = 1<<2;
/// The property that specifies launching the app in the foreground to display preauthorized key-release information.
/// The app launched in the foreground to display information about the pre-authorized key release
        #[doc(alias = "ENActivityFlagsPreAuthorizedKeyReleaseNotificationTapped")]
        const PreAuthorizedKeyReleaseNotificationTapped = 1<<3;
    }
}

unsafe impl Encode for ENActivityFlags {
    const ENCODING: Encoding = u32::ENCODING;
}

unsafe impl RefEncode for ENActivityFlags {
    const ENCODING_REF: Encoding = Encoding::Pointer(&Self::ENCODING);
}

/// The handler the system invokes to report activities that occurred while the app wasn’t running.
///
/// Parameters:
/// - activityFlags: The flags indicating what activity occured while the app wasn’t running.
///
/// Invoked after the app is launched to report activities that occurred while the app might not be running.
#[cfg(feature = "block2")]
pub type ENActivityHandler = *mut block2::DynBlock<dyn Fn(ENActivityFlags)>;

/// The definition of a handler that returns diagnosis keys.
/// Invoked when getDiagnosisKeysWithCompletionHandler completes.
/// If it completes successfully, keys will contain the Diagnosis Keys for this device and error will be nil.
/// If it fails, keys will be nil and error indicates the reason it failed.
#[cfg(all(feature = "ENCommon", feature = "block2"))]
pub type ENGetDiagnosisKeysHandler =
    *mut block2::DynBlock<dyn Fn(*mut NSArray<ENTemporaryExposureKey>, *mut NSError)>;

/// The definition of a handler that returns exposure summaries.
/// Invoked when detecting exposures completes. It provides a summary of exposures.
/// If it completes successfully, summary will contain a summary of exposures and error will be nil.
/// If it fails, summary will be nil and error indicates the reason it failed.
#[cfg(all(feature = "ENCommon", feature = "block2"))]
pub type ENDetectExposuresHandler =
    *mut block2::DynBlock<dyn Fn(*mut ENExposureDetectionSummary, *mut NSError)>;

/// The handler the system invokes after requesting diagnosis keys.
///
/// Parameters:
/// - keys: An array of temporary exposure keys.
///
#[cfg(all(feature = "ENCommon", feature = "block2"))]
pub type ENDiagnosisKeysAvailableHandler =
    *mut block2::DynBlock<dyn Fn(NonNull<NSArray<ENTemporaryExposureKey>>)>;

/// The definition of a handler that receives exposure info.
/// Invoked when getting exposures completes. It provides info about each exposure.
/// If it completes successfully, exposures will contain info about each exposure and error will be nil.
/// If it fails, exposures will be nil and error indicates the reason it failed.
#[cfg(all(feature = "ENCommon", feature = "block2"))]
pub type ENGetExposureInfoHandler =
    *mut block2::DynBlock<dyn Fn(*mut NSArray<ENExposureInfo>, *mut NSError)>;

/// The handler the system invokes when the acquisition of windows completes.
///
/// Parameters:
/// - exposureWindows: An array of available exposure windows. The contents of this array are in no particular order.
///
/// - error: A successful invocation if `nil`; otherwise, the error that occured.
///
///
/// ## Discussion
///
/// <div class="warning">
///
/// ### Important
///  This type is available in iOS 12.5, and in iOS 13.5 and later.
///
///
///
/// </div>
///
/// Invoked when getExposureWindows completes. It provides info about each exposure window.
/// If it completes successfully, exposureWindows will non-nil and error will be nil.
/// If it fails, exposureWindows will be nil and error indicates the reason it failed.
#[cfg(all(feature = "ENCommon", feature = "block2"))]
pub type ENGetExposureWindowsHandler =
    *mut block2::DynBlock<dyn Fn(*mut NSArray<ENExposureWindow>, *mut NSError)>;

/// The handler the system invokes when acquistiion of the user’s travel status completes.
///
/// Parameters:
/// - traveled: Indicates whether the user has traveled.
///
/// - error: A successful invocation if `nil`; otherwise, the error that occured.
///
///
/// ## Discussion
///
/// <div class="warning">
///
/// ### Important
///  This type is available in iOS 12.5, and in iOS 13.5 and later.
///
///
///
/// </div>
///
/// Invoked when getUserTraveled completes.
#[cfg(feature = "block2")]
pub type ENGetUserTraveledHandler = *mut block2::DynBlock<dyn Fn(Bool, *mut NSError)>;

extern_class!(
    /// A class that manages exposure notifications.
    ///
    /// ## Overview
    ///
    /// <div class="warning">
    ///
    /// ### Important
    ///  This class is available in iOS 12.5, and in iOS 13.5 and later.
    ///
    ///
    ///
    /// </div>
    /// Before using an instance of this class, call [`activateWithCompletionHandler:`](https://developer.apple.com/documentation/exposurenotification/enmanager/activate(completionhandler:)). If the completion handler completes successfully, you can work with the remaining properties and methods on the class. Activating this object doesn’t enable exposure notification; it only allows this object to be used. Once activated, exposure notification can be enabled with [`setExposureNotificationEnabled:completionHandler:`](https://developer.apple.com/documentation/exposurenotification/enmanager/setexposurenotificationenabled(_:completionhandler:)), if needed.
    ///
    /// If the app no longer needs an instance of this class, you must call [`invalidate`](https://developer.apple.com/documentation/exposurenotification/enmanager/invalidate()), which stops any outstanding operations and invokes the invalidation handler.
    ///
    /// <div class="warning">
    ///
    /// ### Note
    ///  Invalidation is asynchronous so it’s possible for handlers to be invoked after calling [`invalidate`](https://developer.apple.com/documentation/exposurenotification/enmanager/invalidate()).
    ///
    ///
    ///
    /// </div>
    /// The framework invokes the invalidation handler once invalidation finishes, and performs the invocation exactly once, even if [`invalidate`](https://developer.apple.com/documentation/exposurenotification/enmanager/invalidate()) is called multiple times. It does not call any additional handlers.
    ///
    /// After calling [`invalidate`](https://developer.apple.com/documentation/exposurenotification/enmanager/invalidate()), your app can’t reuse the object. A new object must be created for subsequent use. The framework clears strong references once invalidation completes to break potential retain cycles. You don’t need to use weak references within your handlers to avoid retain cycles when using this class.
    ///
    ///
    /// Manages Exposure Notification functionality.
    #[unsafe(super(NSObject))]
    #[derive(Debug, PartialEq, Eq, Hash)]
    pub struct ENManager;
);

extern_conformance!(
    unsafe impl NSObjectProtocol for ENManager {}
);

impl ENManager {
    extern_methods!(
        #[cfg(feature = "block2")]
        /// Invoked when the app is launched for an activity while it might not be running.
        /// When the app is launched, it should create an ENManager instance, set this handler, and then activate the manager.
        #[unsafe(method(activityHandler))]
        #[unsafe(method_family = none)]
        pub unsafe fn activityHandler(&self) -> ENActivityHandler;

        #[cfg(feature = "block2")]
        /// Setter for [`activityHandler`][Self::activityHandler].
        ///
        /// This is [copied][objc2_foundation::NSCopying::copy] when set.
        ///
        /// # Safety
        ///
        /// `activity_handler` must be a valid pointer or null.
        #[unsafe(method(setActivityHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setActivityHandler(&self, activity_handler: ENActivityHandler);

        #[cfg(feature = "dispatch2")]
        #[unsafe(method(dispatchQueue))]
        #[unsafe(method_family = none)]
        pub unsafe fn dispatchQueue(&self) -> Retained<DispatchQueue>;

        #[cfg(feature = "dispatch2")]
        /// Setter for [`dispatchQueue`][Self::dispatchQueue].
        ///
        /// # Safety
        ///
        /// `dispatch_queue` possibly has additional threading requirements.
        #[unsafe(method(setDispatchQueue:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setDispatchQueue(&self, dispatch_queue: &DispatchQueue);

        /// Overall status of Exposure Notification. KVO may be used to monitor for changes.
        #[unsafe(method(exposureNotificationStatus))]
        #[unsafe(method_family = none)]
        pub unsafe fn exposureNotificationStatus(&self) -> ENStatus;

        #[cfg(feature = "dispatch2")]
        /// Invoked exactly once when invalidation completes. This property is cleared before it's invoked to break retain cycles.
        #[unsafe(method(invalidationHandler))]
        #[unsafe(method_family = none)]
        pub unsafe fn invalidationHandler(&self) -> dispatch_block_t;

        #[cfg(feature = "dispatch2")]
        /// Setter for [`invalidationHandler`][Self::invalidationHandler].
        ///
        /// This is [copied][objc2_foundation::NSCopying::copy] when set.
        ///
        /// # Safety
        ///
        /// `invalidation_handler` must be a valid pointer or null.
        #[unsafe(method(setInvalidationHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setInvalidationHandler(&self, invalidation_handler: dispatch_block_t);

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Activates the object to prepare it for use. Properties may not be usable until the completion handler reports success.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(activateWithCompletionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn activateWithCompletionHandler(&self, completion_handler: ENErrorHandler);

        /// Stops any outstanding operations and invalidates this object. Once this is called, the object can no longer be used.
        /// To start using ENManager again, a new instance of the class must be created and activated.
        #[unsafe(method(invalidate))]
        #[unsafe(method_family = none)]
        pub unsafe fn invalidate(&self);

        #[cfg(feature = "block2")]
        /// Reports if the user traveled within an exposure period (e.g. 14 days).
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(getUserTraveledWithCompletionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn getUserTraveledWithCompletionHandler(
            &self,
            completion_handler: ENGetUserTraveledHandler,
        );

        #[cfg(feature = "ENCommon")]
        /// Reports the current authorization status of the app.
        /// Apps can use this property to preflight authorization in order to determine if the user will be prompted.
        #[unsafe(method(authorizationStatus))]
        #[unsafe(method_family = none)]
        pub unsafe fn authorizationStatus() -> ENAuthorizationStatus;

        /// Indicates if Exposure Notification is enabled on the system. KVO may be used to monitor for changes.
        /// This will be NO until activateWithCompletionHandler has completed successfully.
        /// Note that even if it's enabled, it may be inactive for other reasons, such as Bluetooth being turned off.
        /// The exposureNotificationStatus property can be monitored for the overall status of Exposure Notification.
        #[unsafe(method(exposureNotificationEnabled))]
        #[unsafe(method_family = none)]
        pub unsafe fn exposureNotificationEnabled(&self) -> bool;

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Enables or disables Exposure Notification.
        /// If not previously authorized, this shows a user dialog for consent to enable Exposure Notification.
        /// Note: Disabling stops Bluetooth advertising and scanning related to Exposure Notification, but the
        /// Diagnosis Keys and data will remain.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(setExposureNotificationEnabled:completionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setExposureNotificationEnabled_completionHandler(
            &self,
            enabled: bool,
            completion_handler: ENErrorHandler,
        );

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Detects exposures using the specified configuration to control the scoring algorithm.
        /// This uses the diagnosis keys already known to the system.
        /// Only available to apps with ENAPIVersion 2 or higher.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(detectExposuresWithConfiguration:completionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn detectExposuresWithConfiguration_completionHandler(
            &self,
            configuration: &ENExposureConfiguration,
            completion_handler: ENDetectExposuresHandler,
        ) -> Retained<NSProgress>;

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Detects exposures using the specified configuration to control the scoring algorithm and URLs to specify the
        /// files containing diagnosis keys the app has downloaded. The diagnosis key files must be signed appropriately.
        /// When the app's ENAPIVersion is 2 or higher, keys already known to the system are included in the analysis.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(detectExposuresWithConfiguration:diagnosisKeyURLs:completionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn detectExposuresWithConfiguration_diagnosisKeyURLs_completionHandler(
            &self,
            configuration: &ENExposureConfiguration,
            diagnosis_key_ur_ls: &NSArray<NSURL>,
            completion_handler: ENDetectExposuresHandler,
        ) -> Retained<NSProgress>;

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Gets info about each exposure from the summary provided when exposure detection completes.
        /// Using this API will inform the user that their exposure details have been revealed to the app.
        /// The user explanation string will be displayed as part of the UI to inform the user of using this API.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[deprecated = "Use getExposureWindowsFromSummary, if needed."]
        #[unsafe(method(getExposureInfoFromSummary:userExplanation:completionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn getExposureInfoFromSummary_userExplanation_completionHandler(
            &self,
            summary: &ENExposureDetectionSummary,
            user_explanation: &NSString,
            completion_handler: ENGetExposureInfoHandler,
        ) -> Retained<NSProgress>;

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Gets info about each exposure window from the summary provided when exposure detection completes.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(getExposureWindowsFromSummary:completionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn getExposureWindowsFromSummary_completionHandler(
            &self,
            summary: &ENExposureDetectionSummary,
            completion_handler: ENGetExposureWindowsHandler,
        ) -> Retained<NSProgress>;

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Requests the temporary exposure keys used by this device to share with a server.
        /// Each use of this API will present the user with system UI to authorize it.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(getDiagnosisKeysWithCompletionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn getDiagnosisKeysWithCompletionHandler(
            &self,
            completion_handler: ENGetDiagnosisKeysHandler,
        );

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Requests the temporary exposure keys, including the current key, used by this device for testing.
        /// Each use of this API will present the user with system UI to authorize it.
        /// WARNING: This API is only for use by developers. It requires a special entitlement that is not allowed in the app store.
        /// It's only intended to allow developers to test without needing to wait 24 hours for a key to be released.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(getTestDiagnosisKeysWithCompletionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn getTestDiagnosisKeysWithCompletionHandler(
            &self,
            completion_handler: ENGetDiagnosisKeysHandler,
        );

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Invoked after requestPreAuthorizedDiagnosisKeys if user authorization is still valid.
        ///
        /// # Safety
        ///
        /// The returned block's argument must be a valid pointer.
        #[unsafe(method(diagnosisKeysAvailableHandler))]
        #[unsafe(method_family = none)]
        pub unsafe fn diagnosisKeysAvailableHandler(&self) -> ENDiagnosisKeysAvailableHandler;

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Setter for [`diagnosisKeysAvailableHandler`][Self::diagnosisKeysAvailableHandler].
        ///
        /// This is [copied][objc2_foundation::NSCopying::copy] when set.
        ///
        /// # Safety
        ///
        /// `diagnosis_keys_available_handler` must be a valid pointer or null.
        #[unsafe(method(setDiagnosisKeysAvailableHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setDiagnosisKeysAvailableHandler(
            &self,
            diagnosis_keys_available_handler: ENDiagnosisKeysAvailableHandler,
        );

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Authorizes a one-time, future release of diagnosis keys without a user prompt at the time of release.
        /// This allows the user to authorize ahead of time in case they are unable to approve at the time of positive diagnosis.
        /// WARNING: Application should be in foreground to request the authorization
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(preAuthorizeDiagnosisKeysWithCompletionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn preAuthorizeDiagnosisKeysWithCompletionHandler(
            &self,
            completion_handler: ENErrorHandler,
        );

        #[cfg(all(feature = "ENCommon", feature = "block2"))]
        /// Requests diagnosis keys after previously using preAuthorizeDiagnosisKeys successfully.
        /// This will display a notification to the user for the user to know the keys will be returned.
        /// Keys are returned by invoking diagnosisKeysAvailable, which must be set before calling this.
        ///
        /// # Safety
        ///
        /// `completion_handler` must be a valid pointer.
        #[unsafe(method(requestPreAuthorizedDiagnosisKeysWithCompletionHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn requestPreAuthorizedDiagnosisKeysWithCompletionHandler(
            &self,
            completion_handler: ENErrorHandler,
        );
    );
}

/// Methods declared on superclass `NSObject`.
impl ENManager {
    extern_methods!(
        #[unsafe(method(init))]
        #[unsafe(method_family = init)]
        pub unsafe fn init(this: Allocated<Self>) -> Retained<Self>;

        #[unsafe(method(new))]
        #[unsafe(method_family = new)]
        pub unsafe fn new() -> Retained<Self>;
    );
}
