//! This file has been automatically generated by `objc2`'s `header-translator`.
//! DO NOT EDIT
use core::ffi::*;
use core::ptr::NonNull;
use objc2::__framework_prelude::*;

use crate::*;

extern_class!(
    /// An object for managing fall detection events.
    ///
    /// ## Overview
    ///
    /// In Series 4 and later, Apple Watch can detect when a wearer falls, and contact emergency services if necessary. Using the `CMFallDetectionManager`, your app can request the user’s authorization, and set up a delegate to receive notifications about these _fall detection events_. For more information, see [Use fall detection with Apple Watch](https://support.apple.com/en-us/HT208944).
    ///
    /// <div class="warning">
    ///
    /// ### Important
    ///  To use this API, you must include the [`NSFallDetectionUsageDescription`](https://developer.apple.com/documentation/bundleresources/information-property-list/nsfalldetectionusagedescription) key in your app’s `Info.plist` file and provide a usage description string for the key. The description appears in the prompt that the user receives when the system asks to access fall detection data for your app. If you don’t include a usage description string, your app crashes when you call this API.
    ///
    ///
    ///
    /// </div>
    /// `CMFallDetectionManager` requires an entitlement from Apple. To apply for the entitlement, see [Fall Detection Entitlement Request](https://developer.apple.com/contact/request/fall-detection-api). This entitlement allows the app to run in the background without requiring any additional capabilities. However, you can add capabilities for other background modes, as needed by your app.
    ///
    /// There are two approaches to detecting falls in your app. You can either query for [`HKQuantityTypeIdentifierNumberOfTimesFallen`](https://developer.apple.com/documentation/healthkit/hkquantitytypeidentifier/numberoftimesfallen) samples in HealthKit, or you can use Core Motion’s `CMFallDetectionManager`.
    ///
    /// ### Detect and Respond to Falls
    ///
    /// The Core Motion fall detection manager is particularly useful for apps that need to respond to falls in a timely manner so that the app can provide help to the person who fell.
    ///
    /// The fall detection manager:
    ///
    /// - Notifies the app in real time
    ///
    /// - Notifies the app of all fall events
    ///
    /// - Provides background runtime so that your app can respond to the fall
    ///
    /// ### Detect and Monitor Falls Over Time
    ///
    /// The HealthKit sample is particularly useful for apps that monitor falls over longer time periods, because there can be a delay between the fall event and HealthKit updating its samples.
    ///
    /// HealthKit provides:
    ///
    /// - Samples that are available on all devices that can access the person’s HealthKit data—not just the device that detected the fall
    ///
    /// - Samples for falls where the person who fell confirmed the fall, or the system escalated the fall to emergency services. If the person who fell dismisses the fall alert, HealthKit doesn’t record the fall.
    ///
    /// ### Create the Manager
    ///
    /// To receive fall detection notifications, ensure that the feature is available on the current device. If the feature is available, create the manager and set its delegate.
    ///
    /// ```swift
    /// if CMFallDetectionManager.isAvailable  {
    ///     
    ///     // Create the manager.
    ///     let manager = CMFallDetectionManager()
    ///     
    ///     // Assign a delegate that adopts the CMFallDetectionDelegte protocol.
    ///     manager.delegate = myDelegate
    ///     
    ///     // Keep a reference to the manager.
    ///     myManager = manager
    /// }
    /// ```
    ///
    /// Set the delegate as early as possible, ideally in your extension delegate’s [`applicationDidFinishLaunching`](https://developer.apple.com/documentation/watchkit/wkextensiondelegate/applicationdidfinishlaunching()) method. The system may not instantiate your app’s user interface when launching your app in the background, so you can’t set the delegate from your user interface code, such as when an interface controller activates, or in response to a change in SwiftUI’s [`ScenePhase`](https://developer.apple.com/documentation/swiftui/scenephase) state.
    ///
    /// <div class="warning">
    ///
    /// ### Important
    ///  Create only a single instance of the detection manager. Store the manager in a variable so you can access it later. Be sure to use a variable that remains in memory throughout your app’s lifetime—for example, add the variable to your extension delegate.
    ///
    ///
    ///
    /// </div>
    /// ### Request User Authorization
    ///
    /// After your user interface loads, check if you previously requested approval. If you haven’t, call [`requestAuthorizationWithHandler:`](https://developer.apple.com/documentation/coremotion/cmfalldetectionmanager/requestauthorization(handler:)) to initiate a request.
    ///
    /// ```swift
    /// // Check to see if you have already asked the user to
    /// // authorize fall detection event notifications.
    /// if myManager?.authorizationStatus == .notDetermined {
    ///     
    ///     // Request Authorization.
    ///     myManager?.requestAuthorization { (authorizationStatus) in
    ///         
    ///         // Respond to the authorization status.
    ///     }
    /// }
    /// ```
    ///
    /// Your delegate only receives fall detection event notifications if the user authorizes your app. The user can change your app’s authorization state at any time from Settings > Privacy > Fall Detection.
    ///
    /// After you set the delegate and the user grants authorization, your app checks for recent fall events. If the system finds an event, it calls your delegate’s [`fallDetectionManager:didDetectEvent:completionHandler:`](https://developer.apple.com/documentation/coremotion/cmfalldetectiondelegate/falldetectionmanager(_:diddetect:completionhandler:)) method and passes the most recent event. On subsequent launches, as long as your app remains authorized and the system has detected a recent fall event, the system calls `fallDetectionManager(_:didDetect:completionHandler:)` as soon as you set the delegate.
    ///
    /// The system also wakes your app in the background to respond to any new fall detection events. The system only gives your app a short amount of time to respond to the event and call the completion handler. If the app exceeds the allotted time, the system may suspend it.
    ///
    ///
    /// CMFallDetectionManager
    ///
    ///
    /// Use CMFallDetectionManager to receive information about Fall Detection events. Not all watch models support Fall Detection, check for availability before creating an instance of CMFallDetectionManager.
    /// CMFallDetectionManager requires an entitlement from Apple. To apply for the entitlement, see Fall Detection Entitlement Request.
    ///
    /// Set the delegate immediately after creating an instance of CMFallDetectionManager. Creating multiple instances of CMFallDetectionManager is not supported and should be avoided.
    #[unsafe(super(NSObject))]
    #[derive(Debug, PartialEq, Eq, Hash)]
    pub struct CMFallDetectionManager;
);

extern_conformance!(
    unsafe impl NSObjectProtocol for CMFallDetectionManager {}
);

impl CMFallDetectionManager {
    extern_methods!(
        /// available
        ///
        /// Returns a  value indicating whether the current device supports Fall Detection.
        #[unsafe(method(isAvailable))]
        #[unsafe(method_family = none)]
        pub unsafe fn isAvailable() -> bool;

        #[cfg(feature = "CMAuthorization")]
        /// authorizationStatus
        ///
        /// Returns a value indicating whether the user has authorized the app to receive Fall Detection updates
        #[unsafe(method(authorizationStatus))]
        #[unsafe(method_family = none)]
        pub unsafe fn authorizationStatus(&self) -> CMAuthorizationStatus;

        /// delegate
        ///
        /// The delegate object to receive Fall Detection events.
        #[unsafe(method(delegate))]
        #[unsafe(method_family = none)]
        pub unsafe fn delegate(
            &self,
        ) -> Option<Retained<ProtocolObject<dyn CMFallDetectionDelegate>>>;

        /// Setter for [`delegate`][Self::delegate].
        ///
        /// This is a [weak property][objc2::topics::weak_property].
        #[unsafe(method(setDelegate:))]
        #[unsafe(method_family = none)]
        pub unsafe fn setDelegate(
            &self,
            delegate: Option<&ProtocolObject<dyn CMFallDetectionDelegate>>,
        );

        #[cfg(all(feature = "CMAuthorization", feature = "block2"))]
        /// Requests the user’s permission to access Fall Detection information.
        #[unsafe(method(requestAuthorizationWithHandler:))]
        #[unsafe(method_family = none)]
        pub unsafe fn requestAuthorizationWithHandler(
            &self,
            handler: &block2::DynBlock<dyn Fn(CMAuthorizationStatus)>,
        );
    );
}

/// Methods declared on superclass `NSObject`.
impl CMFallDetectionManager {
    extern_methods!(
        #[unsafe(method(init))]
        #[unsafe(method_family = init)]
        pub unsafe fn init(this: Allocated<Self>) -> Retained<Self>;

        #[unsafe(method(new))]
        #[unsafe(method_family = new)]
        pub unsafe fn new() -> Retained<Self>;
    );
}

extern_protocol!(
    /// A delegate that receives information about fall detection events and authorization status changes.
    /// CMFallDetectionDelegate
    ///
    ///
    /// CMFallDetectionManager notifies its delegate about Fall Detection related information using this protocol
    ///
    /// See also: CMFallDetectionManager
    pub unsafe trait CMFallDetectionDelegate: NSObjectProtocol {
        #[cfg(all(feature = "CMFallDetectionEvent", feature = "block2"))]
        /// Update the delegate with a new Fall Detection event
        ///
        ///
        /// Parameter `handler`: Apps running in the background have a finite amount of time to process Fall Detection events. Call this handler to indicate that the app has finished handling the event. The system may suspend or terminate the app before calling this block.
        ///
        ///
        /// Fall Detection events may occur when the app is not running.
        /// Following a Fall Detection event, the system will launch the watchOS app in the background giving it small amount of background execution time. This time should be used for critical tasks related to the Fall Event. For example: placing a network request or scheduling a local notification.
        /// In order to receive Fall Detection events, create a new CMFallDetectionManager instance and set its delegate early in the watchOS app lifecycle (applicationDidFinishLaunching for example). Note that instances of WKInterfaceController may not be created when launched in the background.
        ///
        /// If multiple Fall Detection events are generated while the app is not running, only the most recent event will be reported on the next app launch.
        ///
        /// The same event may be reported across different app launches, always check the date of the event before processing it.
        ///
        /// Fall Detection events can be simulated with the watchOS simulator. Use it to test the background functionality of your app.
        #[optional]
        #[unsafe(method(fallDetectionManager:didDetectEvent:completionHandler:))]
        #[unsafe(method_family = none)]
        unsafe fn fallDetectionManager_didDetectEvent_completionHandler(
            &self,
            fall_detection_manager: &CMFallDetectionManager,
            event: &CMFallDetectionEvent,
            handler: &block2::DynBlock<dyn Fn()>,
        );

        /// Update the delegate when the app's Fall Detection authorization status changes
        #[optional]
        #[unsafe(method(fallDetectionManagerDidChangeAuthorization:))]
        #[unsafe(method_family = none)]
        unsafe fn fallDetectionManagerDidChangeAuthorization(
            &self,
            fall_detection_manager: &CMFallDetectionManager,
        );
    }
);
